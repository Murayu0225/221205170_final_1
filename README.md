# API仕様書

このアプリはプラクティカルICTの最終課題にて作成したサーバ側アプリケーション．

### 本書に関する注意

- 本書にて掲載しているリクエストURLは全てローカル環境（ポート：5000番）での動作を想定している．本番環境での動作を想定する場合は，リクエストURLを適宜変更する必要がある．

## 1. API詳細

APIの利用方法の詳細を下記に記載する．

### 1.1. 共通仕様

本アプリケーションにおける各APIに共通する仕様を記載する．
ただし，各APIに本項目とは異なる記載がある場合，本項目よりも各APIの記載の方が優先される．

**プロトコル**

- HTTP

**メソッド**

- POST

**認証**

- なし
- 今回のアプリケーションにおいてユーザ登録・ログイン後にセッション管理を必要とする機能はないためリクエスト毎に認証を行っていない．
- ユーザ登録・ログイン処理，それぞれにおいて2度サーバへリクエストを行っている．2度目のリクエストが成功するとそれぞれの処理が完了する仕組みになっている．2度目のリクエスト時にbearerトークン方式で認証することを考えたが，今回は時間の制約上行っていない．

**レスポンスのデータ形式**

|   項目    |        値         |              説明              |
|:-------:|:----------------:|:----------------------------:|
| MIMEタイプ | application/json |    レスポンスのデータ形式をJSON形式で返す     |
|  文字セット  |      UTF-8       |     レスポンスの文字コードをUTF-8で返す     |
| status  |        数値        | サーバのステータスコードを返す（正常な場合200を返す） |

- 授業で扱ったjsonifyを利用したいためステータスコードをjson内に含めている．

**サーバ側で想定外のエラー発生時のレスポンス**

- サーバ内部で想定外のエラーが起きた場合，JSON形式でステータスコード500とともにエラー内容を返す．

サンプルレスポンス

```json
{
    "status": 500,
    "error": "Internal Server Error"
}
```

### 1.2. [新規登録]ユーザネーム・ニックネーム登録

ユーザネーム・ニックネームを登録するAPI．

**リクエストURL**

- `http://localhost:5000/signup`

**リクエストパラメータ**

| パラメータ名 |   名称   |       説明       |  値  | 必須  |
|:------:|:------:|:--------------:|:---:|:---:|
|   u    | ユーザネーム | ユーザが設定したユーザネーム | 文字列 |  ○  |
|   n    | ニックネーム | ユーザが設定したニックネーム | 文字列 |  ○  |

**正常時のレスポンス**

| フィールド  |    名称    |                         説明                          |
|:------:|:--------:|:---------------------------------------------------:|
| status | ステータスコード |                       共通仕様を参照                       |
|  salt  |   ソルト    | パスワードをソルト付きにする際に使用するソルト文字列<div>(ランダムで生成される10文字の文字列) |

**正常時のサンプルレスポンス**

```json
{
  "status": 200,
  "salt": "Il2UNdwLJV"
}
```

**エラー時のレスポンス**

| フィールド  |    名称    |       説明        |  値  |
|:------:|:--------:|:---------------:|:---:|
| status | ステータスコード | 共通仕様を参照（値は下記参照） | 数値  |

| ステータスコード |               説明               |
|:--------:|:------------------------------:|
|   409    | 登録しようとしたユーザ名がすでにデータベースに登録されていた |

**エラー時のサンプルレスポンス**

```json
{
  "status": 409
}
```

## 1.3. [新規登録]パスワード登録

1.2.で登録したユーザのハッシュ化したソルト付きパスワードを登録するAPI．

**リクエストURL**

- `http://localhost:5000/signup/auth`

**リクエストパラメータ**

| パラメータ名 |   名称   |                      説明                      |  値  | 必須  |
|:------:|:------:|:--------------------------------------------:|:---:|:---:|
|   u    | ユーザネーム |                ユーザが設定したユーザネーム                | 文字列 |  ○  |
|   p    | パスワード  | ユーザが設定したパスワードと1.2で受け取ったソルト文字列をくっつけてハッシュ化したもの | 文字列 |  ○  |

**正常時のレスポンス**

|  フィールド   |    名称    |       説明       |  値  |
|:--------:|:--------:|:--------------:|:---:|
|  status  | ステータスコード |    共通仕様を参照     | 数値  |
| nickname |  ニックネーム  | ユーザが設定したニックネーム | 文字列 |

**正常時のサンプルレスポンス**

```json
{
  "status": 200,
  "nickname": "test"
}
```

**エラー時のレスポンス**

| フィールド  |    名称    |       説明        |   値    |
|:------:|:--------:|:---------------:|:------:|
| status | ステータスコード | 共通仕様を参照（値は下記参照） |   数値   |

| ステータスコード |        説明         |
|:--------:|:-----------------:|
|   401    | データベースにユーザ登録が行えない |

**エラー時のサンプルレスポンス**

```json
{
  "status": 401
}
```

## 1.4. [ログイン]ユーザネーム存在確認

ログイン時にユーザネームが登録済みであるか確認する．

**リクエストURL**

- `http://localhost:5000/signuin`

**リクエストパラメータ**

| パラメータ名 |   名称   |         説明         |  値  | 必須  |
|:------:|:------:|:------------------:|:---:|:---:|
|   u    | ユーザネーム | ユーザが登録時に設定したユーザネーム | 文字列 |  ○  |

**正常時のレスポンス**

| フィールド  |    名称    |            説明             |  値  |
|:------:|:--------:|:-------------------------:|:---:|
| status | ステータスコード |          共通仕様を参照          | 数値  |
|  salt  |   ソルト    | パスワードをハッシュ化する際に使用するソルト文字列 | 文字列 |

**正常時のサンプルレスポンス**

```json
{
  "status": 200,
  "salt": "Il2UNdwLJV"
}
```

**エラー時のレスポンス**

| フィールド  |    名称    |       説明        |  値  |
|:------:|:--------:|:---------------:|:---:|
| status | ステータスコード | 共通仕様を参照（値は下記参照） | 数値  |

| ステータスコード |               説明               |
|:--------:|:------------------------------:|
|   404    | ログインを試みたユーザネームがデータベースに登録されていない |

**エラー時のサンプルレスポンス**

```json
{
  "status": 404
}
```

## 1.5. [ログイン]ログイン処理

1.2.でリクエストしたユーザのハッシュ化したソルト付きパスワードを利用してログインするAPI．

**リクエストURL**

- `http://localhost:5000/signin/auth`

**リクエストパラメータ**

| パラメータ名 |   名称   |                        説明                        |  値  | 必須  |
|:------:|:------:|:------------------------------------------------:|:---:|:---:|
|   u    | ユーザネーム |                ユーザが登録時に設定したユーザネーム                | 文字列 |  ○  |
|   p    | パスワード  | ユーザが登録時に設定したパスワードと1.2で受け取ったソルト文字列をくっつけてハッシュ化したもの | 文字列 |  ○  |

**正常時のレスポンス**

|  フィールド   |    名称    |         説明         |        値        |
|:--------:|:--------:|:------------------:|:---------------:|
|  status  | ステータスコード |      共通仕様を参照       |       数値        |
| nickname |  ニックネーム  | ユーザが登録時に設定したニックネーム |       文字列       |

**正常時のサンプルレスポンス**

```json
{
  "status": 200,
  "nickname": "test"
}
```

**エラー時のレスポンス**

| フィールド  |    名称    |       説明        |    値     |
|:------:|:--------:|:---------------:|:--------:|
| status | ステータスコード | 共通仕様を参照（値は下記参照） |    数値    |

| ステータスコード |         説明         |
|:--------:|:------------------:|
|   401    | パスワードがデータベースと一致しない |

**エラー時のサンプルレスポンス**

```json
{
  "status": 401
}
```

## ライセンス
[MITライセンス](./LICENSE)の元提供されている．
